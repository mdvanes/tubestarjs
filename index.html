<html>
  <head>
    <style>
      html,
      body {
        background-color: darkslategray;
        color: white;
        font-weight: bold;
        font-family: sans-serif;
        height: 100%;
        margin: 0;
      }

      main {
        display: flex;
        height: 100%;
        align-items: center;
      }

      main > ul {
        flex: 0.5;
        text-align: center;
        list-style-type: none;
      }

      main > div {
        flex: 1;
      }
    </style>
    <title>Tubestar.js</title>
  </head>
  <body>
    <main>
      <ul>
        <li id="topic">
          topic:
          <span></span>
        </li>

        <li id="payload">
          payload:
          <span></span>
        </li>
      </ul>
      <div id="linechart" style="width: 600px; height: 400px"></div>
    </main>

    <script src="/echarts.js"></script>

    <script type="text/javascript">
      const source = new EventSource("/events");

      const chartDom = document.getElementById("linechart");
      const myChart = echarts.init(chartDom);
      const data = [];
      const option = {
        xAxis: {
          type: "category",
        },
        yAxis: {
          type: "value",
        },
        series: [
          {
            data,
            type: "line",
            smooth: true,
          },
        ],
      };

      option && myChart.setOption(option);

      source.addEventListener("message", (message) => {
        const { topic, payload } = JSON.parse(event.data);

        document.querySelector("#topic > span").innerHTML = topic;
        document.querySelector("#payload > span").innerHTML = payload;

        data.push(payload);
        myChart.setOption({
          series: [
            {
              data,
              type: "line",
              smooth: true,
            },
          ],
        });
      });
    </script>
  </body>
</html>
